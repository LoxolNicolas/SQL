/*DROP TABLE COMMANDE;*/
/*DROP TABLE ARTICLE;*/
/*DROP TABLE CLIENT;*/
/*DROP TABLE FOURNISSEUR;*/

CREATE TABLE FOURNISSEUR(
    NumFour NUMBER(10) PRIMARY KEY,
    NomFour VARCHAR2(10) NOT NULL
);

CREATE TABLE CLIENT(
    NumClt NUMBER(10) PRIMARY KEY,
    NomClt VARCHAR2(10) NOT NULL, 
    Adresse VARCHAR2(30),
    NumTel CHAR(10)
);

CREATE TABLE ARTICLE(
    NumArt NUMBER(10) PRIMARY KEY,
    Libelle VARCHAR2(10),
    NumFour NUMBER(10) REFERENCES FOURNISSEUR(NumFour)
);

CREATE TABLE COMMANDE(
    NumArt NUMBER(10) REFERENCES ARTICLE(NumArt), 
    NumClt NUMBER(10) REFERENCES CLIENT(NumClt),
    PRIMARY KEY(NumArt, NumClt),
    Quantite NUMBER(10) CONSTRAINT CK_QTE CHECK(Quantite>0) NOT NULL
);

INSERT INTO FOURNISSEUR VALUES(1, 'Magouille');
INSERT INTO FOURNISSEUR VALUES(2, 'Rigolo');
INSERT INTO FOURNISSEUR VALUES(3, 'Sympa');
INSERT INTO FOURNISSEUR VALUES(4, 'Chouette');

INSERT INTO CLIENT VALUES(10, 'Picsou', 'Nice', NULL);
INSERT INTO CLIENT VALUES(40, 'Dingo', 'Clermont-Ferrand', '0473425812');
INSERT INTO CLIENT VALUES(15, 'Picsou', 'Nantes', '0240121565');
INSERT INTO CLIENT VALUES(55, 'Mickey', 'Brest', '0251245287');

INSERT INTO ARTICLE VALUES(1, 'Pomme', 3);
INSERT INTO ARTICLE VALUES(2, 'Poire', 3);
INSERT INTO ARTICLE VALUES(3, 'Fraise', 1);
INSERT INTO ARTICLE VALUES(4, 'Prune', 2);

INSERT INTO COMMANDE VALUES(1, 15, 10);
INSERT INTO COMMANDE VALUES(3, 40, 35);
INSERT INTO COMMANDE VALUES(2, 40, 42);
INSERT INTO COMMANDE VALUES(3, 15, 12);
INSERT INTO COMMANDE VALUES(2, 55, 80);
INSERT INTO COMMANDE VALUES(1, 10, 60);

/* Q3 Q4 Q5 */

INSERT INTO ARTICLE VALUES(1, 'Pomme', 4);
INSERT INTO COMMANDE VALUES(1, 55, 0);
INSERT INTO COMMANDE VALUES(1, 55, NULL);

/* Q6 */

UPDATE CLIENT
SET Adresse='Bordeaux'
WHERE NumClt = 10;

/* Q7 */

INSERT INTO FOURNISSEUR VALUES(5, 'Relax');
INSERT INTO FOURNISSEUR VALUES(6,'Pointu');
INSERT INTO FOURNISSEUR VALUES(7, 'Odieux');

DELETE FROM FOURNISSEUR
WHERE NumFour=5;

DELETE FROM FOURNISSEUR
WHERE NumFour=6;

DELETE FROM FOURNISSEUR
WHERE NumFour=7;

/* rollback / commit voir poly */

/* Q8 */

DELETE FROM CLIENT
WHERE NumClt=15;

/* car cle etrangere dans commande */

/* Q9 */

ALTER TABLE COMMANDE DROP CONSTRAINT SYS_C00154982;

ALTER TABLE COMMANDE ADD CONSTRAINT FK_NumClt FOREIGN KEY(NumClt) REFERENCES CLIENT(NumClt) ON DELETE CASCADE;

/* Q10 */

ALTER TABLE FOURNISSEUR
ADD (NumTel CHAR(14));

UPDATE FOURNISSEUR
SET NumTel='02-23-12-50-27'
WHERE NumFour=3;

/* Q11 */

UPDATE FOURNISSEUR
SET NomFour=SUBSTR(NomFour, 1, 6);

ALTER TABLE FOURNISSEUR
MODIFY (NomFour VARCHAR2(6));

/* Q12 */

SELECT *
FROM user_cons_columns
WHERE table_name='COMMANDE';



